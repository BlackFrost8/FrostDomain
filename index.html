<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Focus Domain</title>
    <style>
        :root {
            --main-color: #00ffff;
            --glow-intensity: 1;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            width: 100vw;
            height: 100vh;
            overflow: hidden;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #000;
            color: white;
        }
        
        .wallpaper-container {
            width: 100%;
            height: 100%;
            position: relative;
        }
        
        .wallpaper {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            display: none;
            opacity: 0;
            transition: opacity 1s ease-in-out;
        }
        
        .wallpaper.active {
            display: block;
            opacity: 1;
        }
        
        .instructions {
            position: absolute;
            top: 20px;
            left: 0;
            width: 100%;
            text-align: center;
            z-index: 100;
            padding: 10px;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            font-size: 14px;
            color: var(--main-color);
            text-shadow: 0 0 calc(5px * var(--glow-intensity)) var(--main-color);
            transition: opacity 2s ease-in-out;
            pointer-events: none;
        }
        
        .instructions.fade-out {
            opacity: 0 !important;
            pointer-events: none;
        }

        .invisible-arrow {
            position: fixed;
            top: 50%;
            transform: translateY(-50%);
            color: var(--main-color);
            font-size: 40px;
            width: 60px;
            height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 2000;
            opacity: 1;
            pointer-events: auto;
            text-shadow: 0 0 calc(10px * var(--glow-intensity)) var(--main-color);
            transition: opacity 0.3s ease;
        }

        .invisible-arrow.mobile-arrow {
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s ease;
            top: auto !important;
            bottom: 30px !important;
            transform: none !important;
            font-size: 40px;
            width: 60px;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }

        .invisible-arrow.mobile-arrow.visible-arrows {
            opacity: 0.8 !important;
            pointer-events: auto !important;
        }

        .invisible-arrow.desktop-arrow {
            opacity: 0;
            pointer-events: none;
            top: 50% !important;
            transform: translateY(-50%) !important;
            bottom: auto !important;
        }

        .invisible-arrow.desktop-arrow.visible {
            opacity: 1;
            pointer-events: auto;
        }

        .invisible-arrow.left {
            left: 20px;
        }

        .invisible-arrow.right {
            right: 20px;
        }

        .invisible-arrow.left.mobile-arrow {
            left: 20px !important;
            right: auto !important;
        }
        
        .invisible-arrow.right.mobile-arrow {
            right: 20px !important;
            left: auto !important;
        }

        #profile-hover {
            position: fixed;
            top: 20px;
            right: -250px;
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid var(--main-color);
            border-radius: 8px;
            padding: 10px 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 3000;
            transition: right 0.3s ease;
            backdrop-filter: blur(5px);
        }

        #profile-hover.visible {
            right: 20px;
        }

        #profile-hover-avatar {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: #003333;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            border: 1px solid var(--main-color);
            background-size: cover;
            background-position: center;
        }

        #profile-hover-name {
            color: var(--main-color);
            font-size: 0.9rem;
        }

        #control-panel {
            position: fixed;
            top: 0;
            left: -300px;
            width: 300px;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            border-right: 1px solid var(--main-color);
            z-index: 4000;
            transition: left 0.3s ease;
            padding: 20px;
            overflow-y: auto;
            backdrop-filter: blur(10px);
        }

        #control-panel.visible {
            left: 0;
        }

        #control-panel h2 {
            color: var(--main-color);
            margin-bottom: 20px;
            text-align: center;
            text-shadow: 0 0 calc(5px * var(--glow-intensity)) var(--main-color);
        }

        .control-group {
            margin-bottom: 25px;
        }

        .control-group h3 {
            color: var(--main-color);
            margin-bottom: 10px;
            font-size: 1.1rem;
            border-bottom: 1px solid var(--main-color);
            padding-bottom: 5px;
        }

        .control-button {
            width: 100%;
            padding: 12px;
            margin: 8px 0;
            background: rgba(0, 0, 0, 0.7);
            color: var(--main-color);
            border: 1px solid var(--main-color);
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Courier New', monospace;
            text-align: left;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .control-button:hover {
            background: var(--main-color);
            color: black;
            transform: translateX(5px);
        }

        .control-button i {
            font-style: normal;
            width: 24px;
            text-align: center;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.85);
            z-index: 3001;
            opacity: 0;
            transition: opacity 0.3s ease;
            align-items: center;
            justify-content: center;
        }

        .modal.visible {
            display: flex;
            opacity: 1;
        }

        .modal-content {
            background-color: black;
            border: 2px solid var(--main-color);
            border-radius: 8px;
            padding: 20px;
            width: 400px;
            max-width: 90%;
            box-shadow: 0 0 calc(20px * var(--glow-intensity)) var(--main-color);
            color: var(--main-color);
            position: relative;
            transform: scale(0.95);
            transition: transform 0.2s ease;
        }

        .modal.visible .modal-content {
            transform: scale(1);
        }

        .modal-content h2 {
            text-align: center;
            margin-bottom: 20px;
            text-shadow: 0 0 calc(10px * var(--glow-intensity)) var(--main-color);
        }

        .close-modal {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            color: var(--main-color);
            font-size: 20px;
            cursor: pointer;
            z-index: 1;
        }

        #save-load-tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--main-color);
        }

        .save-load-tab {
            flex: 1;
            text-align: center;
            padding: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .save-load-tab.active {
            background-color: var(--main-color);
            color: black;
        }

        #save-section, #load-section {
            display: none;
        }

        #save-section.active, #load-section.active {
            display: block;
        }

        #code-word-input, #load-code-input {
            width: 100%;
            padding: 10px;
            background-color: black;
            color: var(--main-color);
            border: 1px solid var(--main-color);
            margin-bottom: 15px;
            font-family: 'Courier New', monospace;
            outline: none;
        }

        #save-button, #load-button, #email-export {
            width: 100%;
            padding: 10px;
            background-color: black;
            color: var(--main-color);
            border: 1px solid var(--main-color);
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Courier New', monospace;
            margin-bottom: 10px;
        }

        #save-button:hover, #load-button:hover, #email-export:hover {
            background-color: var(--main-color);
            color: black;
        }

        #save-status, #load-status {
            margin-top: 10px;
            text-align: center;
            font-size: 0.9rem;
            min-height: 20px;
        }

        #export-import-tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--main-color);
        }

        .export-import-tab {
            flex: 1;
            text-align: center;
            padding: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .export-import-tab.active {
            background-color: var(--main-color);
            color: black;
        }

        #export-section, #import-section {
            display: none;
        }

        #export-section.active, #import-section.active {
            display: block;
        }

        #export-code {
            width: 100%;
            padding: 10px;
            background-color: black;
            color: var(--main-color);
            border: 1px solid var(--main-color);
            margin-bottom: 15px;
            font-family: 'Courier New', monospace;
            resize: vertical;
            min-height: 80px;
            outline: none;
        }

        #import-code {
            width: 100%;
            padding: 10px;
            background-color: black;
            color: var(--main-color);
            border: 1px solid var(--main-color);
            margin-bottom: 15px;
            font-family: 'Courier New', monospace;
            resize: vertical;
            min-height: 80px;
            outline: none;
        }

        #copy-export, #import-button {
            width: 100%;
            padding: 10px;
            background-color: black;
            color: var(--main-color);
            border: 1px solid var(--main-color);
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Courier New', monospace;
        }

        #copy-export:hover, #import-button:hover {
            background-color: var(--main-color);
            color: black;
        }

        #export-status, #import-status {
            margin-top: 10px;
            text-align: center;
            font-size: 0.9rem;
            min-height: 20px;
        }

        .theme-control {
            margin: 15px 0;
        }

        .theme-control label {
            display: block;
            margin-bottom: 5px;
        }

        #color-picker {
            width: 100%;
            height: 50px;
            border: 2px solid var(--main-color);
            border-radius: 5px;
            background: black;
            cursor: pointer;
        }

        #glow-slider {
            width: 100%;
            margin: 10px 0;
        }

        #glow-value {
            text-align: center;
            font-size: 0.9rem;
        }

        #apply-theme {
            width: 100%;
            padding: 10px;
            background-color: black;
            color: var(--main-color);
            border: 1px solid var(--main-color);
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
        }

        #apply-theme:hover {
            background-color: var(--main-color);
            color: black;
        }

        .profile-control {
            margin: 15px 0;
        }

        .profile-control label {
            display: block;
            margin-bottom: 5px;
        }

        .profile-control input {
            width: 100%;
            padding: 8px;
            background-color: black;
            color: var(--main-color);
            border: 1px solid var(--main-color);
            border-radius: 4px;
        }

        #profile-preview {
            text-align: center;
            margin: 15px 0;
        }

        #profile-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            border: 2px solid var(--main-color);
            margin: 0 auto 10px;
            background-color: #003333;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            background-size: cover;
            background-position: center;
        }

        #save-profile {
            width: 100%;
            padding: 10px;
            background-color: black;
            color: var(--main-color);
            border: 1px solid var(--main-color);
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
        }

        #save-profile:hover {
            background-color: var(--main-color);
            color: black;
        }

        #notes-content {
            height: 400px;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        #notes-text {
            flex: 1;
            background-color: black;
            color: var(--main-color);
            border: 1px solid var(--main-color);
            padding: 10px;
            font-family: 'Courier New', monospace;
            resize: none;
            outline: none;
            margin-bottom: 10px;
        }

        #save-notes {
            padding: 10px;
            background-color: black;
            color: var(--main-color);
            border: 1px solid var(--main-color);
            cursor: pointer;
            transition: all 0.3s;
        }

        #save-notes:hover {
            background-color: var(--main-color);
            color: black;
        }

        #info-modal-content {
            width: 500px;
            max-width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            padding-right: 15px;
        }

        #info-modal-content::-webkit-scrollbar {
            width: 8px;
        }

        #info-modal-content::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.3);
        }

        #info-modal-content::-webkit-scrollbar-thumb {
            background: var(--main-color);
            border-radius: 4px;
        }

        #info-modal-content::-webkit-scrollbar-thumb:hover {
            background: #00cccc;
        }

        #timer-wallpaper {
            background-color: black;
            color: var(--main-color);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            font-family: 'Courier New', Courier, monospace;
            overflow: hidden;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        #timer-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: black;
            border: 2px solid var(--main-color);
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 0 calc(15px * var(--glow-intensity)) var(--main-color);
            z-index: 100;
            text-align: center;
        }

        .time-inputs {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin: 15px 0;
        }

        .time-input-group {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .time-input {
            background-color: black;
            color: var(--main-color);
            border: 1px solid var(--main-color);
            padding: 8px;
            width: 50px;
            text-align: center;
            -moz-appearance: textfield;
            outline: none;
            font-size: 16px;
            pointer-events: auto;
        }

        .time-input::-webkit-outer-spin-button,
        .time-input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        #start-timer {
            background-color: black;
            color: var(--main-color);
            border: 1px solid var(--main-color);
            padding: 8px 20px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 16px;
            pointer-events: auto;
        }

        #start-timer:hover {
            background-color: var(--main-color);
            color: black;
        }

        #active-timer {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 5rem;
            color: var(--main-color);
            text-shadow: 0 0 calc(10px * var(--glow-intensity)) var(--main-color);
            z-index: 100;
            pointer-events: none;
        }

        .binary-stream {
            position: absolute;
            color: var(--main-color);
            font-size: 1.5rem;
            pointer-events: none;
            opacity: 0.7;
            animation: flow-out linear forwards;
        }

        @keyframes flow-out {
            0% { 
                transform: translate(0, 0) scale(1);
                opacity: 0.8;
            }
            100% { 
                transform: translate(
                    calc(var(--tx) * 200px),
                    calc(var(--ty) * 200px)
                ) scale(0.5);
                opacity: 0;
            }
        }

        #control-buttons {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 15px;
            z-index: 101;
            opacity: 0.7;
            transition: opacity 0.3s;
        }

        #control-buttons:hover {
            opacity: 1;
        }

        .control-btn {
            background-color: rgba(0, 0, 0, 0.5);
            color: var(--main-color);
            border: 1px solid var(--main-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            font-size: 18px;
            transition: all 0.3s;
        }

        .control-btn:hover {
            background-color: var(--main-color);
            color: black;
            transform: scale(1.1);
        }

        /* Timer Notification Styles */
        .timer-notification {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: black;
            border: 2px solid var(--main-color);
            border-radius: 12px;
            padding: 30px;
            z-index: 10000;
            text-align: center;
            box-shadow: 0 0 calc(30px * var(--glow-intensity)) var(--main-color);
            animation: notification-pulse 2s infinite;
            max-width: 90%;
            width: 400px;
        }

        .timer-notification-icon {
            font-size: 48px;
            color: var(--main-color);
            margin-bottom: 15px;
        }

        .timer-notification-title {
            font-size: 24px;
            color: var(--main-color);
            margin-bottom: 10px;
            text-shadow: 0 0 calc(10px * var(--glow-intensity)) var(--main-color);
        }

        .timer-notification-message {
            font-size: 18px;
            color: var(--main-color);
            margin-bottom: 20px;
            opacity: 0.9;
        }

        .timer-notification-button {
            background-color: black;
            color: var(--main-color);
            border: 1px solid var(--main-color);
            padding: 10px 30px;
            font-size: 16px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Courier New', monospace;
            margin-top: 10px;
        }

        .timer-notification-button:hover {
            background-color: var(--main-color);
            color: black;
            transform: scale(1.05);
        }

        @keyframes notification-pulse {
            0% {
                box-shadow: 0 0 calc(20px * var(--glow-intensity)) var(--main-color);
            }
            50% {
                box-shadow: 0 0 calc(40px * var(--glow-intensity)) var(--main-color);
            }
            100% {
                box-shadow: 0 0 calc(20px * var(--glow-intensity)) var(--main-color);
            }
        }

        /* Mobile adjustments for notification */
        @media (max-width: 768px) {
            .timer-notification {
                width: 90%;
                padding: 20px;
            }
            
            .timer-notification-icon {
                font-size: 36px;
            }
            
            .timer-notification-title {
                font-size: 20px;
            }
            
            .timer-notification-message {
                font-size: 16px;
            }
            
            .timer-notification-button {
                padding: 8px 20px;
                font-size: 14px;
            }
        }

        #todo-wallpaper {
            background-color: black;
            color: var(--main-color);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            font-family: 'Courier New', Courier, monospace;
            overflow: hidden;
        }

        #todo-wallpaper h1 {
            text-align: center;
            margin-bottom: 20px;
            z-index: 1;
        }

        #todo-wallpaper #add-task {
            padding: 15px;
            background-color: black;
            color: var(--main-color);
            cursor: pointer;
            font-size: 24px;
            transition: background-color 0.3s, color 0.3s;
            margin-bottom: 20px;
            border-radius: 50%;
            border: 2px solid var(--main-color);
            box-shadow: 0 0 calc(10px * var(--glow-intensity)) var(--main-color);
            z-index: 1;
        }

        #todo-wallpaper #add-task:hover {
            background-color: var(--main-color);
            color: black;
        }

        #todo-wallpaper #task-list {
            list-style-type: none;
            padding: 0;
            width: 300px;
            z-index: 1;
            transition: opacity 1s ease;
            max-height: 60vh;
            overflow-y: auto;
            overflow-x: hidden;
            margin-bottom: 20px;
        }

        #todo-wallpaper #task-list::-webkit-scrollbar {
            width: 5px;
        }

        #todo-wallpaper #task-list::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.3);
        }

        #todo-wallpaper #task-list::-webkit-scrollbar-thumb {
            background: var(--main-color);
            border-radius: 2px;
        }

        #todo-wallpaper .task {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            color: var(--main-color);
        }

        #todo-wallpaper .check-box {
            width: 20px;
            height: 20px;
            border: 2px solid var(--main-color);
            border-radius: 4px;
            margin-right: 10px;
            cursor: pointer;
            transition: background-color 0.3s ease;
            flex-shrink: 0;
        }

        #todo-wallpaper .checked {
            background-color: var(--main-color);
        }

        #todo-wallpaper .task-text {
            flex-grow: 1;
            transition: text-decoration 0.3s ease, opacity 0.3s ease;
            word-break: break-word;
            max-width: calc(100% - 30px);
        }

        #todo-wallpaper .checked-text {
            text-decoration: line-through;
            opacity: 0.5;
        }

        #todo-wallpaper #modal {
            display: none;
            position: fixed;
            z-index: 2;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.8);
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        #todo-wallpaper #modal.visible {
            display: block;
            opacity: 1;
        }

        #todo-wallpaper #modal-content {
            background-color: black;
            margin: 25% auto;
            padding: 20px;
            width: 300px;
            border-radius: 8px;
            display: flex;
            justify-content: center;
        }

        #todo-wallpaper #new-task-input {
            width: 100%;
            padding: 10px;
            border: none;
            background-color: black;
            color: var(--main-color);
            font-size: 20px;
            font-family: 'Courier New', Courier, monospace;
            transition: box-shadow 0.3s;
            border-radius: 4px;
        }

        #todo-wallpaper #new-task-input::placeholder {
            color: var(--main-color);
            opacity: 0.7;
            font-family: 'Courier New', Courier, monospace;
        }

        #todo-wallpaper #new-task-input:focus {
            outline: none;
            box-shadow: 0 0 10px var(--main-color);
        }

        #todo-wallpaper .celebration {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 3em;  
            animation: pop 0.5s ease-in-out forwards;
            z-index: 1000;
            pointer-events: none;
            text-align: center;
        }

        @keyframes pop {
            0% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 1;
            }
            50% {
                transform: translate(-50%, -50%) scale(1.5);
                opacity: 0.7;
            }
            100% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 0;
            }
        }

        #todo-wallpaper .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: var(--main-color);
            animation: confetti-fall 1.5s ease-in forwards;
            pointer-events: none;
            z-index: 999;
        }

        @keyframes confetti-fall {
            0% {
                transform: translateY(-100vh) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }

        #image-wallpaper {
            background-color: #000;
            color: var(--main-color);
            font-family: 'Courier New', monospace;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
            overflow: hidden;
        }

        #image-wallpaper .container {
            text-align: center;
            z-index: 10;
            padding: 30px;
            border: 2px solid var(--main-color);
            border-radius: 8px;
            background-color: rgba(0, 0, 0, 0.8);
            box-shadow: 0 0 calc(20px * var(--glow-intensity)) var(--main-color);
            max-width: 90%;
        }

        #image-wallpaper h1 {
            font-size: 2.5rem;
            margin-bottom: 40px;
            text-shadow: 0 0 calc(10px * var(--glow-intensity)) var(--main-color);
        }

        #image-wallpaper .upload-btn {
            background-color: #000;
            color: var(--main-color);
            border: 2px solid var(--main-color);
            padding: 15px 30px;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s;
            margin: 30px 0 20px 0;
            font-family: 'Courier New', monospace;
            box-shadow: 0 0 calc(10px * var(--glow-intensity)) var(--main-color);
        }

        #image-wallpaper .upload-btn:hover {
            background-color: var(--main-color);
            color: #000;
            transform: scale(1.05);
        }

        #image-wallpaper #fileInput {
            display: none;
        }

        #image-wallpaper #imageDisplay {
            display: none;
        }

        #image-wallpaper .fullscreen-mode {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: black;
            z-index: 1500;
            display: none;
        }

        #image-wallpaper .fullscreen-image {
            width: 100%;
            height: 100%;
            object-fit: contain;
            pointer-events: none;
        }

        #image-wallpaper .file-info {
            margin-top: 15px;
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .mobile-menu-button {
            display: none;
            position: fixed;
            top: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid var(--main-color);
            border-radius: 4px;
            color: var(--main-color);
            font-size: 24px;
            cursor: pointer;
            z-index: 5000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
        }

        .mobile-menu-button.active {
            background: var(--main-color);
            color: black;
        }

        .mobile-controls-container {
            display: none;
            position: fixed;
            top: 70px;
            right: 20px;
            width: 250px;
            background: rgba(0, 0, 0, 0.95);
            border: 1px solid var(--main-color);
            border-radius: 8px;
            padding: 15px;
            z-index: 4999;
            backdrop-filter: blur(10px);
            max-height: calc(100vh - 90px);
            overflow-y: auto;
        }

        .mobile-controls-container.visible {
            display: block;
        }

        .mobile-control-group {
            margin-bottom: 20px;
        }

        .mobile-control-group h3 {
            color: var(--main-color);
            margin-bottom: 10px;
            font-size: 1rem;
            border-bottom: 1px solid var(--main-color);
            padding-bottom: 5px;
        }

        .mobile-control-button {
            width: 100%;
            padding: 10px;
            margin: 5px 0;
            background: rgba(0, 0, 0, 0.7);
            color: var(--main-color);
            border: 1px solid var(--main-color);
            border-radius: 4px;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            text-align: left;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            transition: all 0.3s;
        }

        .mobile-control-button:hover {
            background: var(--main-color);
            color: black;
            transform: translateX(5px);
        }

        .mobile-control-button i {
            font-style: normal;
            width: 24px;
            text-align: center;
        }

        .profile-upload-btn {
            width: 100%;
            padding: 10px;
            background-color: black;
            color: var(--main-color);
            border: 1px solid var(--main-color);
            border-radius: 4px;
            cursor: pointer;
            text-align: center;
            margin-top: 10px;
            transition: all 0.3s;
        }

        .profile-upload-btn:hover {
            background-color: var(--main-color);
            color: black;
        }

        .fullscreen-toggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid var(--main-color);
            border-radius: 50%;
            color: var(--main-color);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 2001;
            font-size: 20px;
            transition: all 0.3s ease;
            opacity: 0.6;
            line-height: 1;
            padding: 0;
        }

        .fullscreen-toggle:hover {
            opacity: 1;
            transform: scale(1.1);
            background: var(--main-color);
            color: black;
        }

        .fullscreen-toggle svg {
            width: 24px;
            height: 24px;
            fill: currentColor;
        }

        @media (max-width: 768px) {
            .instructions {
                font-size: 12px;
                padding: 8px;
            }
            
            .invisible-arrow.mobile-arrow {
                opacity: 0;
                font-size: 40px;
                width: 60px;
                height: 80px;
                top: auto !important;
                bottom: 30px !important;
                transform: none !important;
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 2000;
                pointer-events: none;
            }
            
            .invisible-arrow.mobile-arrow.visible-arrows {
                opacity: 0.8 !important;
                pointer-events: auto !important;
            }
            
            .invisible-arrow.left.mobile-arrow {
                left: 20px !important;
                right: auto !important;
            }
            
            .invisible-arrow.right.mobile-arrow {
                right: 20px !important;
                left: auto !important;
            }
            
            #control-panel {
                display: none;
            }
            
            .mobile-menu-button {
                display: flex;
            }
            
            .modal-content {
                width: 95%;
                padding: 15px;
            }
            
            #info-modal-content {
                width: 95%;
            }
            
            #timer-wallpaper #timer-popup {
                width: 90%;
                padding: 15px;
            }
            
            .time-inputs {
                gap: 5px;
            }
            
            .time-input {
                width: 40px;
                padding: 5px;
                font-size: 14px;
            }
            
            #todo-wallpaper {
                padding-bottom: 80px;
            }
            
            #todo-wallpaper #task-list {
                width: 90%;
                max-height: 50vh;
                margin-bottom: 80px;
            }
            
            #todo-wallpaper #add-task {
                margin-bottom: 80px;
            }
            
            #image-wallpaper .container {
                padding: 20px;
            }
            
            #image-wallpaper h1 {
                font-size: 1.8rem;
                margin-bottom: 20px;
            }
            
            #image-wallpaper .upload-btn {
                padding: 12px 20px;
                font-size: 1rem;
            }
            
            #active-timer {
                font-size: 3rem;
            }
            
            #control-buttons {
                bottom: 20px;
                gap: 10px;
            }
            
            .control-btn {
                width: 35px;
                height: 35px;
                font-size: 16px;
            }
            
            .fullscreen-toggle {
                bottom: 15px;
                right: 15px;
                width: 35px;
                height: 35px;
                font-size: 16px;
            }
            
            .fullscreen-toggle svg {
                width: 20px;
                height: 20px;
            }
        }

        @media (min-width: 769px) {
            .mobile-menu-button,
            .mobile-controls-container {
                display: none !important;
            }
            
            .invisible-arrow.mobile-arrow {
                display: none;
            }
            
            #control-panel {
                display: block;
            }
        }
    </style>
</head>
<body>
    <div class="instructions" id="instructions">
        Hover top-left corner for controls | Press Alt-I for keyboard shortcuts
    </div>

    <div id="control-panel">
        <h2>Focus Domain Controls</h2>
        
        <div class="control-group">
            <h3>Navigation</h3>
            <button class="control-button" id="prev-wallpaper-btn">
                <i>‚óÄ</i> Previous Wallpaper
            </button>
            <button class="control-button" id="next-wallpaper-btn">
                <i>‚ñ∂</i> Next Wallpaper
            </button>
        </div>
        
        <div class="control-group">
            <h3>System</h3>
            <button class="control-button" id="save-load-btn">
                <i>üíæ</i> Save & Load
            </button>
            <button class="control-button" id="theme-btn">
                <i>üé®</i> Theme Customizer
            </button>
            <button class="control-button" id="profile-btn">
                <i>üë§</i> Profile Settings
            </button>
            <button class="control-button" id="notes-btn">
                <i>üìù</i> Notes
            </button>
            <button class="control-button" id="info-btn">
                <i>‚ÑπÔ∏è</i> Information
            </button>
        </div>
        
        <div class="control-group">
            <h3>Timer Controls</h3>
            <button class="control-button" id="timer-start-btn">
                <i>‚è±Ô∏è</i> Start Timer
            </button>
            <button class="control-button" id="timer-pause-btn">
                <i>‚è∏Ô∏è</i> Pause/Resume Timer
            </button>
            <button class="control-button" id="timer-add-btn">
                <i>‚ûï</i> Add 5 Minutes
            </button>
            <button class="control-button" id="timer-reset-btn">
                <i>üîÑ</i> Reset Timer
            </button>
        </div>
        
        <div class="control-group">
            <h3>To-Do List</h3>
            <button class="control-button" id="todo-add-btn">
                <i>‚ûï</i> Add Task
            </button>
            <button class="control-button" id="todo-clear-btn">
                <i>üóëÔ∏è</i> Clear Completed
            </button>
        </div>
    </div>

    <div class="invisible-arrow left desktop-arrow" id="prev-wallpaper">‚óÄ</div>
    <div class="invisible-arrow right desktop-arrow" id="next-wallpaper">‚ñ∂</div>
    
    <div class="invisible-arrow left mobile-arrow" id="prev-wallpaper-mobile">‚óÄ</div>
    <div class="invisible-arrow right mobile-arrow" id="next-wallpaper-mobile">‚ñ∂</div>
    
    <div class="mobile-menu-button" id="mobile-menu-button">‚ò∞</div>
    
    <div class="mobile-controls-container" id="mobile-controls-container">
        <div class="mobile-control-group">
            <h3>Navigation</h3>
            <button class="mobile-control-button" id="prev-wallpaper-btn-mobile">
                <i>‚óÄ</i> Previous Wallpaper
            </button>
            <button class="mobile-control-button" id="next-wallpaper-btn-mobile">
                <i>‚ñ∂</i> Next Wallpaper
            </button>
        </div>
        
        <div class="mobile-control-group">
            <h3>System</h3>
            <button class="mobile-control-button" id="save-load-btn-mobile">
                <i>üíæ</i> Save & Load
            </button>
            <button class="mobile-control-button" id="theme-btn-mobile">
                <i>üé®</i> Theme Customizer
            </button>
            <button class="mobile-control-button" id="profile-btn-mobile">
                <i>üë§</i> Profile Settings
            </button>
            <button class="mobile-control-button" id="notes-btn-mobile">
                <i>üìù</i> Notes
            </button>
            <button class="mobile-control-button" id="info-btn-mobile">
                <i>‚ÑπÔ∏è</i> Information
            </button>
            <button class="mobile-control-button" id="exit-image-btn-mobile">
                <i>üö™</i> Exit Fullscreen Image
            </button>
        </div>
        
        <div class="mobile-control-group">
            <h3>Timer Controls</h3>
            <button class="mobile-control-button" id="timer-start-btn-mobile">
                <i>‚è±Ô∏è</i> Start Timer
            </button>
            <button class="mobile-control-button" id="timer-pause-btn-mobile">
                <i>‚è∏Ô∏è</i> Pause/Resume Timer
            </button>
            <button class="mobile-control-button" id="timer-add-btn-mobile">
                <i>‚ûï</i> Add 5 Minutes
            </button>
            <button class="mobile-control-button" id="timer-reset-btn-mobile">
                <i>üîÑ</i> Reset Timer
            </button>
        </div>
        
        <div class="mobile-control-group">
            <h3>To-Do List</h3>
            <button class="mobile-control-button" id="todo-add-btn-mobile">
                <i>‚ûï</i> Add Task
            </button>
            <button class="mobile-control-button" id="todo-clear-btn-mobile">
                <i>üóëÔ∏è</i> Clear Completed
            </button>
        </div>
    </div>
    
    <div id="profile-hover">
        <div id="profile-hover-avatar">üë§</div>
        <div id="profile-hover-name">User</div>
    </div>

    <div class="fullscreen-toggle" id="fullscreen-toggle" title="Toggle Fullscreen">
        <svg viewBox="0 0 24 24">
            <path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/>
        </svg>
    </div>

    <div id="save-load-modal" class="modal">
        <div class="modal-content">
            <button class="close-modal" id="close-save-load">√ó</button>
            <h2>Save & Load</h2>
            
            <div id="save-load-tabs">
                <div class="save-load-tab active" data-tab="save">Save</div>
                <div class="save-load-tab" data-tab="load">Load</div>
                <div class="save-load-tab" data-tab="export-import">Export/Import</div>
            </div>
            
            <div id="save-section" class="active">
                <p>Create a code word to save your current progress:</p>
                <input type="text" id="code-word-input" placeholder="Enter code word">
                <button id="save-button">Save Progress</button>
                <div id="save-status"></div>
            </div>
            
            <div id="load-section">
                <p>Enter your code word to load saved progress:</p>
                <input type="text" id="load-code-input" placeholder="Enter code word">
                <button id="load-button">Load Progress</button>
                <div id="load-status"></div>
            </div>

            <div id="export-import-tabs" style="display: none;">
                <div class="export-import-tab active" data-tab="export">Export</div>
                <div class="export-import-tab" data-tab="import">Import</div>
            </div>
            
            <div id="export-section" style="display: none;">
                <p>Export your data to use on another device:</p>
                <textarea id="export-code" readonly placeholder="Your export code will appear here"></textarea>
                <button id="copy-export">Copy Export Code</button>
                <button id="email-export">Email Export Code</button>
                <div id="export-status"></div>
            </div>
            
            <div id="import-section" style="display: none;">
                <p>Paste your export code from another device:</p>
                <textarea id="import-code" placeholder="Paste your export code here"></textarea>
                <button id="import-button">Import Data</button>
                <div id="import-status"></div>
            </div>
        </div>
    </div>

    <div id="theme-modal" class="modal">
        <div class="modal-content">
            <button class="close-modal" id="close-theme">√ó</button>
            <h2>Theme Customizer</h2>
            
            <div class="theme-control">
                <label>Select Color:</label>
                <input type="color" id="color-picker" value="#00ffff">
            </div>
            
            <div class="theme-control">
                <label>Glow Intensity: <span id="glow-value">1.0</span></label>
                <input type="range" id="glow-slider" min="0.1" max="2" step="0.1" value="1">
            </div>
            
            <button id="apply-theme">Apply Theme</button>
        </div>
    </div>

    <div id="profile-modal" class="modal">
        <div class="modal-content">
            <button class="close-modal" id="close-profile">√ó</button>
            <h2>Profile Settings</h2>
            
            <div id="profile-preview">
                <div id="profile-avatar">üë§</div>
                <div id="profile-name-display">User</div>
            </div>
            
            <div class="profile-control">
                <label>Name:</label>
                <input type="text" id="profile-name" placeholder="Enter your name">
            </div>
            
            <div class="profile-control">
                <label>Email:</label>
                <input type="email" id="profile-email" placeholder="Enter your email">
            </div>
            
            <div class="profile-control">
                <label>Profile Picture:</label>
                <input type="text" id="profile-avatar-url" placeholder="Or paste image URL">
            </div>
            
            <div class="profile-upload-btn" id="upload-avatar-btn">
                Upload Image from Computer
            </div>
            <input type="file" id="avatar-file-input" accept="image/*" style="display: none;">
            
            <button id="save-profile">Save Profile</button>
        </div>
    </div>

    <div id="notes-modal" class="modal">
        <div class="modal-content" id="notes-content">
            <button class="close-modal" id="close-notes">√ó</button>
            <h2>Notes</h2>
            <textarea id="notes-text" placeholder="Type your notes here..."></textarea>
            <button id="save-notes">Save Notes</button>
        </div>
    </div>

    <div id="info-modal" class="modal">
        <div class="modal-content" id="info-modal-content">
            <button class="close-modal" id="close-info-modal">√ó</button>
            <h2>Hotkeys Information</h2>
            <div style="text-align: left; line-height: 1.6;">
                <p><strong>Navigation:</strong></p>
                <ul>
                    <li>‚Üê ‚Üí Arrow Keys: Switch between wallpapers</li>
                    <li>Mouse near edges: Show navigation arrows</li>
                    <li>Hover top-left corner: Show control panel</li>
                </ul>
                
                <p><strong>Timer Wallpaper:</strong></p>
                <ul>
                    <li>Enter: Start timer with current inputs</li>
                    <li>Shift + R: Reset timer</li>
                    <li>+ Button: Add 5 minutes</li>
                    <li>II Button: Pause/Resume timer</li>
                    <li>‚Üª Button: Reset timer</li>
                    <li><strong>NEW:</strong> Timer completion notification with theme colors</li>
                    <li><strong>NEW:</strong> Browser tab title flashes when timer completes</li>
                    <li><strong>NEW:</strong> Desktop notification when timer completes (permission required)</li>
                </ul>
                
                <p><strong>To-Do List:</strong></p>
                <ul>
                    <li>Enter: Add new task</li>
                    <li>Click checkbox: Mark task complete</li>
                    <li>Escape: Close modal</li>
                    <li>Click outside: Close modal</li>
                </ul>
                
                <p><strong>System Controls:</strong></p>
                <ul>
                    <li>Hover top-left corner: Show control panel with all functions</li>
                    <li>CTRL + ALT + S: Open Save/Load menu</li>
                    <li>SHIFT + C: Open Theme Customizer</li>
                    <li>CTRL + ALT + P: Open Profile Settings</li>
                    <li>ALT + N: Open Notes</li>
                    <li>ALT + I: Open this information panel</li>
                    <li>ESC: Exit fullscreen image viewer</li>
                    <li>F11 or Fullscreen button: Toggle fullscreen mode</li>
                </ul>
                
                <p><strong>Save/Load System:</strong></p>
                <ul>
                    <li>Create code words to save progress</li>
                    <li>Export/Import for cross-device sync</li>
                    <li>Email export codes to your profile email</li>
                    <li>Automatic updates when changes occur</li>
                </ul>
                
                <p><strong>Mobile Controls:</strong></p>
                <ul>
                    <li>Tap ‚ò∞ menu: Access all controls</li>
                    <li>Tap bottom of screen: Show navigation arrows</li>
                    <li>üö™ Exit Fullscreen Image: Return to image selection</li>
                </ul>
                
                <p><strong>Cross-Tab Notifications:</strong></p>
                <ul>
                    <li>Timer completion alerts you even when in another tab</li>
                    <li>Tab title flashes between "Timer Complete!" and "Focus Domain"</li>
                    <li>Desktop notifications can be enabled by clicking "Allow Notifications" when prompted</li>
                </ul>
            </div>
        </div>
    </div>
    
    <div class="wallpaper-container">
        <div id="timer-wallpaper" class="wallpaper active">
            <div id="timer-popup">
                <h2>Study Timer</h2>
                <div class="time-inputs">
                    <div class="time-input-group">
                        <label>Hours</label>
                        <input type="number" class="time-input" id="hours" min="0" value="0">
                    </div>
                    <div class="time-input-group">
                        <label>Minutes</label>
                        <input type="number" class="time-input" id="minutes" min="0" value="25">
                    </div>
                    <div class="time-input-group">
                        <label>Seconds</label>
                        <input type="number" class="time-input" id="seconds" min="0" value="0">
                    </div>
                </div>
                <button id="start-timer">Start</button>
            </div>

            <div id="active-timer"></div>

            <div id="control-buttons" style="display: none;">
                <button id="add-time" class="control-btn" title="Add 5 minutes">+</button>
                <button id="pause-timer" class="control-btn" title="Pause/Resume">II</button>
                <button id="reset-timer" class="control-btn" title="Reset timer">‚Üª</button>
            </div>
        </div>

        <div id="todo-wallpaper" class="wallpaper">
            <h1>To-Do List</h1>

            <button id="add-task">+</button>

            <ul id="task-list"></ul>

            <div id="modal">
                <div id="modal-content">
                    <input type="text" id="new-task-input" placeholder="Enter a new task" autofocus>
                </div>
            </div>

            <div id="celebration-container" style="display: none;"></div>
        </div>

        <div id="image-wallpaper" class="wallpaper">
            <div class="container">
                <h1>FULLSCREEN VIEWER</h1>
                
                <label for="fileInput" class="upload-btn">SELECT IMAGE</label>
                <input type="file" id="fileInput" accept="image/*">
                
                <div class="file-info" id="fileInfo"></div>
            </div>

            <div class="fullscreen-mode" id="fullscreenMode">
                <img class="fullscreen-image" id="fullscreenImage" alt="Fullscreen image">
            </div>
        </div>
    </div>

    <script>
        (function() {
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            
            const instructions = document.getElementById('instructions');
            const controlPanel = document.getElementById('control-panel');
            const prevWallpaperBtn = document.getElementById('prev-wallpaper-btn');
            const nextWallpaperBtn = document.getElementById('next-wallpaper-btn');
            const saveLoadBtn = document.getElementById('save-load-btn');
            const themeBtn = document.getElementById('theme-btn');
            const profileBtn = document.getElementById('profile-btn');
            const notesBtn = document.getElementById('notes-btn');
            const infoBtn = document.getElementById('info-btn');
            const timerStartBtn = document.getElementById('timer-start-btn');
            const timerPauseBtn = document.getElementById('timer-pause-btn');
            const timerAddBtn = document.getElementById('timer-add-btn');
            const timerResetBtn = document.getElementById('timer-reset-btn');
            const todoAddBtn = document.getElementById('todo-add-btn');
            const todoClearBtn = document.getElementById('todo-clear-btn');
            const fullscreenToggle = document.getElementById('fullscreen-toggle');
            
            const prevWallpaperBtnMobile = document.getElementById('prev-wallpaper-btn-mobile');
            const nextWallpaperBtnMobile = document.getElementById('next-wallpaper-btn-mobile');
            const saveLoadBtnMobile = document.getElementById('save-load-btn-mobile');
            const themeBtnMobile = document.getElementById('theme-btn-mobile');
            const profileBtnMobile = document.getElementById('profile-btn-mobile');
            const notesBtnMobile = document.getElementById('notes-btn-mobile');
            const infoBtnMobile = document.getElementById('info-btn-mobile');
            const timerStartBtnMobile = document.getElementById('timer-start-btn-mobile');
            const timerPauseBtnMobile = document.getElementById('timer-pause-btn-mobile');
            const timerAddBtnMobile = document.getElementById('timer-add-btn-mobile');
            const timerResetBtnMobile = document.getElementById('timer-reset-btn-mobile');
            const todoAddBtnMobile = document.getElementById('todo-add-btn-mobile');
            const todoClearBtnMobile = document.getElementById('todo-clear-btn-mobile');
            const exitImageBtnMobile = document.getElementById('exit-image-btn-mobile');
            
            const saveLoadModal = document.getElementById('save-load-modal');
            const themeModal = document.getElementById('theme-modal');
            const profileModal = document.getElementById('profile-modal');
            const notesModal = document.getElementById('notes-modal');
            const infoModal = document.getElementById('info-modal');
            
            const wallpapers = document.querySelectorAll('.wallpaper');
            const prevWallpaperArrow = document.getElementById('prev-wallpaper');
            const nextWallpaperArrow = document.getElementById('next-wallpaper');
            const prevWallpaperArrowMobile = document.getElementById('prev-wallpaper-mobile');
            const nextWallpaperArrowMobile = document.getElementById('next-wallpaper-mobile');
            
            const profileHover = document.getElementById('profile-hover');
            const profileHoverName = document.getElementById('profile-hover-name');
            const profileHoverAvatar = document.getElementById('profile-hover-avatar');
            
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const mobileControlsContainer = document.getElementById('mobile-controls-container');
            
            let currentWallpaperIndex = 0;
            let isControlPanelVisible = false;
            let isMobileMenuOpen = false;
            let currentImageData = localStorage.getItem('currentImageData') || null;
            
            let timerInterval = null;
            let remainingSeconds = 0;
            let isTimerRunning = false;
            let isTimerPaused = false;
            let timerEndTime = 0;
            let lastUpdateTime = Date.now();
            
            // Mobile arrow fade control
            let mobileArrowTimeout;
            let isMobileArrowsVisible = false;
            
            // To-Do list variables
            let taskCount = 0;
            let todoListInitialized = false;
            
            // Timer notification variables
            let hasShownTimerNotification = false;
            let titleFlashInterval = null;
            let originalTitle = document.title;
            
            // Request notification permission on load
            if ('Notification' in window && Notification.permission === 'default') {
                Notification.requestPermission();
            }
            
            document.addEventListener('DOMContentLoaded', initializeApp);
            
            function initializeApp() {
                if (isMobile) {
                    document.body.classList.add('mobile');
                    instructions.textContent = "Tap bottom of screen to show navigation arrows";
                    mobileMenuButton.style.display = 'flex';
                    
                    const desktopArrows = document.querySelectorAll('.desktop-arrow');
                    desktopArrows.forEach(arrow => arrow.style.display = 'none');
                    
                    const mobileArrows = document.querySelectorAll('.mobile-arrow');
                    mobileArrows.forEach(arrow => {
                        arrow.style.display = 'flex';
                        arrow.classList.remove('visible-arrows');
                        arrow.style.pointerEvents = 'none';
                    });
                    
                    // Setup mobile arrow behavior at bottom
                    setupMobileArrowBehavior();
                } else {
                    document.body.classList.add('desktop');
                    mobileMenuButton.style.display = 'none';
                    mobileControlsContainer.style.display = 'none';
                    
                    const desktopArrows = document.querySelectorAll('.desktop-arrow');
                    desktopArrows.forEach(arrow => arrow.style.display = 'flex');
                    
                    const mobileArrows = document.querySelectorAll('.mobile-arrow');
                    mobileArrows.forEach(arrow => arrow.style.display = 'none');
                }
                
                setupEventListeners();
                showWallpaper(currentWallpaperIndex);
                
                // FIXED: Instructions fade out after 3 seconds
                setTimeout(() => {
                    instructions.classList.add('fade-out');
                }, 3000);
                
                loadProfile();
                loadTodos();
                loadImageFromStorage();
                initializeTimerFromStorage();
                
                window.addEventListener('beforeunload', saveCurrentState);
                
                // Listen for page visibility changes to stop title flashing when user returns
                document.addEventListener('visibilitychange', () => {
                    if (!document.hidden && titleFlashInterval) {
                        stopTitleFlash();
                        document.title = originalTitle;
                    }
                });
            }
            
            // Mobile arrow behavior - completely disappear and reappear only briefly at bottom
            function setupMobileArrowBehavior() {
                if (!isMobile) return;
                
                // Initially hide mobile arrows completely
                hideMobileArrows();
                
                // Show arrows on touch near bottom edges
                document.addEventListener('touchstart', handleMobileTouch);
                document.addEventListener('touchend', handleMobileTouchEnd);
                document.addEventListener('touchmove', handleMobileTouch);
                
                // Also show on mouse movement near bottom for devices with mouse support
                document.addEventListener('mousemove', handleMobileMouseMove);
            }
            
            function handleMobileTouch(e) {
                if (!isMobile) return;
                
                const touch = e.touches[0] || e.changedTouches[0];
                if (!touch) return;
                
                const y = touch.clientY;
                const windowHeight = window.innerHeight;
                const x = touch.clientX;
                const windowWidth = window.innerWidth;
                
                // Show arrows if touching near bottom of screen (bottom 100px) OR near edges
                if (y > windowHeight - 100 || x < 50 || x > windowWidth - 50) {
                    showMobileArrowsTemporarily();
                }
            }
            
            function handleMobileTouchEnd(e) {
                if (!isMobile) return;
                
                const touch = e.changedTouches[0];
                if (!touch) return;
                
                const y = touch.clientY;
                const windowHeight = window.innerHeight;
                const x = touch.clientX;
                const windowWidth = window.innerWidth;
                
                // If touch ended near bottom or edges, show arrows briefly
                if (y > windowHeight - 100 || x < 50 || x > windowWidth - 50) {
                    showMobileArrowsTemporarily();
                }
            }
            
            function handleMobileMouseMove(e) {
                if (!isMobile) return;
                
                const y = e.clientY;
                const windowHeight = window.innerHeight;
                const x = e.clientX;
                const windowWidth = window.innerWidth;
                
                // Show arrows if mouse is near bottom or edges
                if (y > windowHeight - 100 || x < 50 || x > windowWidth - 50) {
                    showMobileArrowsTemporarily();
                }
            }
            
            function showMobileArrowsTemporarily() {
                if (!isMobile) return;
                
                clearTimeout(mobileArrowTimeout);
                
                // Show arrows with visible class
                showMobileArrows();
                isMobileArrowsVisible = true;
                
                // Hide after 2 seconds
                mobileArrowTimeout = setTimeout(() => {
                    hideMobileArrows();
                    isMobileArrowsVisible = false;
                }, 2000);
            }
            
            function showMobileArrows() {
                if (!isMobile) return;
                
                const mobileArrows = document.querySelectorAll('.mobile-arrow');
                mobileArrows.forEach(arrow => {
                    arrow.classList.add('visible-arrows');
                    arrow.style.pointerEvents = 'auto';
                });
            }
            
            function hideMobileArrows() {
                if (!isMobile) return;
                
                const mobileArrows = document.querySelectorAll('.mobile-arrow');
                mobileArrows.forEach(arrow => {
                    arrow.classList.remove('visible-arrows');
                    arrow.style.pointerEvents = 'none';
                });
            }
            
            function saveCurrentState() {
                localStorage.setItem('currentWallpaperIndex', currentWallpaperIndex.toString());
            }
            
            function initializeTimerFromStorage() {
                const savedEndTime = localStorage.getItem('timerEndTime');
                const savedPaused = localStorage.getItem('timerPaused');
                const savedRemaining = localStorage.getItem('timerRemaining');
                
                const savedWallpaperIndex = localStorage.getItem('currentWallpaperIndex');
                if (savedWallpaperIndex) {
                    currentWallpaperIndex = parseInt(savedWallpaperIndex);
                }
                
                if (savedEndTime) {
                    const now = Date.now();
                    const endTime = parseInt(savedEndTime);
                    
                    if (savedPaused === 'true' && savedRemaining) {
                        remainingSeconds = parseInt(savedRemaining);
                        isTimerPaused = true;
                        timerEndTime = endTime;
                        showActiveTimer();
                        updateTimerDisplay(remainingSeconds);
                        if (document.getElementById('pause-timer')) {
                            document.getElementById('pause-timer').textContent = '‚ñ∂';
                        }
                    } else if (endTime > now) {
                        remainingSeconds = Math.ceil((endTime - now) / 1000);
                        timerEndTime = endTime;
                        isTimerRunning = true;
                        showActiveTimer();
                        startTimerCountdown();
                    } else {
                        clearTimerStorage();
                    }
                }
            }
            
            function clearTimerStorage() {
                localStorage.removeItem('timerEndTime');
                localStorage.removeItem('timerPaused');
                localStorage.removeItem('timerRemaining');
            }
            
            // Function to flash the tab title when timer completes
            function startTitleFlash() {
                stopTitleFlash(); // Clear any existing interval
                
                let flashCount = 0;
                titleFlashInterval = setInterval(() => {
                    if (flashCount % 2 === 0) {
                        document.title = '‚è∞ Timer Complete! ‚è∞';
                    } else {
                        document.title = originalTitle;
                    }
                    flashCount++;
                    
                    // Stop flashing after 30 seconds or when user returns to tab
                    if (flashCount > 60) { // 30 seconds at 500ms interval
                        stopTitleFlash();
                        document.title = originalTitle;
                    }
                }, 500);
            }
            
            function stopTitleFlash() {
                if (titleFlashInterval) {
                    clearInterval(titleFlashInterval);
                    titleFlashInterval = null;
                }
            }
            
            // Function to show desktop notification
            function showDesktopNotification() {
                if (!('Notification' in window)) {
                    console.log('This browser does not support desktop notifications');
                    return;
                }
                
                if (Notification.permission === 'granted') {
                    const mainColor = getComputedStyle(document.documentElement).getPropertyValue('--main-color').trim();
                    
                    const notification = new Notification('‚è∞ Timer Complete!', {
                        body: 'Your study session has ended. Great work!',
                        icon: 'data:image/svg+xml,' + encodeURIComponent(`
                            <svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100">
                                <circle cx="50" cy="50" r="45" fill="black" stroke="${mainColor}" stroke-width="3"/>
                                <text x="50" y="70" font-size="40" text-anchor="middle" fill="${mainColor}">‚è∞</text>
                            </svg>
                        `),
                        badge: 'data:image/svg+xml,' + encodeURIComponent(`
                            <svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100">
                                <circle cx="50" cy="50" r="45" fill="black" stroke="${mainColor}" stroke-width="3"/>
                                <text x="50" y="70" font-size="40" text-anchor="middle" fill="${mainColor}">‚è∞</text>
                            </svg>
                        `),
                        tag: 'timer-complete',
                        renotify: true,
                        silent: false
                    });
                    
                    notification.onclick = function() {
                        window.focus();
                        this.close();
                    };
                    
                    // Auto-close after 10 seconds
                    setTimeout(() => notification.close(), 10000);
                    
                } else if (Notification.permission !== 'denied') {
                    Notification.requestPermission().then(permission => {
                        if (permission === 'granted') {
                            showDesktopNotification();
                        }
                    });
                }
            }
            
            // Enhanced timer completion notification with cross-tab awareness
            function showTimerCompletionNotification() {
                // Prevent multiple notifications
                if (hasShownTimerNotification) return;
                hasShownTimerNotification = true;
                
                // Get current theme color
                const mainColor = getComputedStyle(document.documentElement).getPropertyValue('--main-color').trim();
                
                // 1. Show in-app notification
                showInAppNotification(mainColor);
                
                // 2. Flash tab title (works even in other tabs)
                startTitleFlash();
                
                // 3. Show desktop notification (if permitted)
                showDesktopNotification();
                
                // 4. Play a subtle sound
                playNotificationSound();
            }
            
            function showInAppNotification(mainColor) {
                // Create notification container if it doesn't exist
                let notificationContainer = document.getElementById('timer-notification-container');
                if (!notificationContainer) {
                    notificationContainer = document.createElement('div');
                    notificationContainer.id = 'timer-notification-container';
                    document.body.appendChild(notificationContainer);
                }
                
                // Create notification element
                const notification = document.createElement('div');
                notification.className = 'timer-notification';
                notification.style.setProperty('--main-color', mainColor);
                
                // Build notification content
                notification.innerHTML = `
                    <div class="timer-notification-icon">‚è∞</div>
                    <div class="timer-notification-title">Timer Complete!</div>
                    <div class="timer-notification-message">Your study session has ended</div>
                    <button class="timer-notification-button" id="dismiss-timer-notification">Dismiss</button>
                `;
                
                notificationContainer.appendChild(notification);
                
                // Add event listener to dismiss button
                const dismissBtn = document.getElementById('dismiss-timer-notification');
                dismissBtn.addEventListener('click', () => {
                    notification.remove();
                    hasShownTimerNotification = false;
                    stopTitleFlash();
                    document.title = originalTitle;
                });
                
                // Auto-dismiss after 10 seconds
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.remove();
                        hasShownTimerNotification = false;
                        stopTitleFlash();
                        document.title = originalTitle;
                    }
                }, 10000);
            }
            
            function playNotificationSound() {
                try {
                    // Create a simple beep using Web Audio API
                    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    
                    // Resume audio context if it's suspended (browser autoplay policy)
                    if (audioContext.state === 'suspended') {
                        audioContext.resume();
                    }
                    
                    // Create oscillators for a more noticeable sound
                    const oscillator1 = audioContext.createOscillator();
                    const oscillator2 = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator1.type = 'sine';
                    oscillator1.frequency.setValueAtTime(880, audioContext.currentTime); // A5 note
                    
                    oscillator2.type = 'sine';
                    oscillator2.frequency.setValueAtTime(1108.73, audioContext.currentTime); // C#6 note
                    
                    gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                    
                    oscillator1.connect(gainNode);
                    oscillator2.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator1.start();
                    oscillator2.start();
                    oscillator1.stop(audioContext.currentTime + 0.5);
                    oscillator2.stop(audioContext.currentTime + 0.5);
                } catch (e) {
                    // Silently fail if audio is not supported
                    console.log('Audio notification not supported');
                }
            }
            
            function setupEventListeners() {
                document.addEventListener('mousemove', handleMouseMove);
                
                prevWallpaperBtn.addEventListener('click', () => changeWallpaper(-1));
                nextWallpaperBtn.addEventListener('click', () => changeWallpaper(1));
                prevWallpaperArrow.addEventListener('click', () => changeWallpaper(-1));
                nextWallpaperArrow.addEventListener('click', () => changeWallpaper(1));
                
                prevWallpaperBtnMobile.addEventListener('click', () => changeWallpaper(-1));
                nextWallpaperBtnMobile.addEventListener('click', () => changeWallpaper(1));
                prevWallpaperArrowMobile.addEventListener('click', () => changeWallpaper(-1));
                nextWallpaperArrowMobile.addEventListener('click', () => changeWallpaper(1));
                
                saveLoadBtn.addEventListener('click', () => toggleModal(saveLoadModal));
                themeBtn.addEventListener('click', () => toggleModal(themeModal));
                profileBtn.addEventListener('click', () => toggleModal(profileModal));
                notesBtn.addEventListener('click', () => toggleModal(notesModal));
                infoBtn.addEventListener('click', () => toggleModal(infoModal));
                
                saveLoadBtnMobile.addEventListener('click', () => {
                    toggleModal(saveLoadModal);
                    toggleMobileMenu();
                });
                themeBtnMobile.addEventListener('click', () => {
                    toggleModal(themeModal);
                    toggleMobileMenu();
                });
                profileBtnMobile.addEventListener('click', () => {
                    toggleModal(profileModal);
                    toggleMobileMenu();
                });
                notesBtnMobile.addEventListener('click', () => {
                    toggleModal(notesModal);
                    toggleMobileMenu();
                });
                infoBtnMobile.addEventListener('click', () => {
                    toggleModal(infoModal);
                    toggleMobileMenu();
                });
                
                // New exit image button for mobile
                exitImageBtnMobile.addEventListener('click', () => {
                    exitImageFullscreen();
                    toggleMobileMenu();
                });
                
                timerStartBtn.addEventListener('click', startTimer);
                timerPauseBtn.addEventListener('click', togglePauseTimer);
                timerAddBtn.addEventListener('click', addFiveMinutes);
                timerResetBtn.addEventListener('click', resetTimer);
                
                timerStartBtnMobile.addEventListener('click', () => {
                    startTimer();
                    toggleMobileMenu();
                });
                timerPauseBtnMobile.addEventListener('click', () => {
                    togglePauseTimer();
                    toggleMobileMenu();
                });
                timerAddBtnMobile.addEventListener('click', () => {
                    addFiveMinutes();
                    toggleMobileMenu();
                });
                timerResetBtnMobile.addEventListener('click', () => {
                    resetTimer();
                    toggleMobileMenu();
                });
                
                todoAddBtn.addEventListener('click', addTodo);
                todoClearBtn.addEventListener('click', clearCompletedTodos);
                
                todoAddBtnMobile.addEventListener('click', () => {
                    addTodo();
                    toggleMobileMenu();
                });
                todoClearBtnMobile.addEventListener('click', () => {
                    clearCompletedTodos();
                    toggleMobileMenu();
                });
                
                document.querySelectorAll('.close-modal').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const modal = btn.closest('.modal');
                        closeModal(modal);
                    });
                });
                
                mobileMenuButton.addEventListener('click', toggleMobileMenu);
                fullscreenToggle.addEventListener('click', toggleFullscreen);
                
                document.addEventListener('click', (e) => {
                    if (isMobileMenuOpen && 
                        !mobileControlsContainer.contains(e.target) && 
                        !mobileMenuButton.contains(e.target)) {
                        closeMobileMenu();
                    }
                });
                
                setupSaveLoadSystem();
                setupThemeCustomizer();
                setupProfileSystem();
                setupNotesSystem();
                setupTimerWallpaper();
                setupTodoWallpaper();
                setupImageWallpaper();
            }
            
            // New function to exit image fullscreen mode
            function exitImageFullscreen() {
                const container = document.querySelector('#image-wallpaper .container');
                const fullscreenMode = document.getElementById('fullscreenMode');
                const fileInput = document.getElementById('fileInput');
                const fileInfo = document.getElementById('fileInfo');
                
                if (fullscreenMode.style.display === 'block') {
                    container.style.display = 'block';
                    fullscreenMode.style.display = 'none';
                    fileInput.value = '';
                    if (fileInfo) {
                        fileInfo.textContent = '';
                    }
                    
                    // Show a brief confirmation
                    const instructions = document.getElementById('instructions');
                    const originalText = instructions.textContent;
                    instructions.textContent = '‚úì Image viewer exited';
                    instructions.style.opacity = '1';
                    instructions.style.color = 'var(--main-color)';
                    instructions.classList.remove('fade-out');
                    setTimeout(() => {
                        instructions.textContent = originalText;
                        instructions.style.opacity = '0.7';
                        instructions.style.color = 'var(--main-color)';
                        instructions.classList.add('fade-out');
                    }, 2000);
                } else {
                    // If not in fullscreen mode, show a message
                    const instructions = document.getElementById('instructions');
                    const originalText = instructions.textContent;
                    instructions.textContent = '‚ö† No image is currently open';
                    instructions.style.opacity = '1';
                    instructions.style.color = '#ff9900';
                    instructions.classList.remove('fade-out');
                    setTimeout(() => {
                        instructions.textContent = originalText;
                        instructions.style.opacity = '0.7';
                        instructions.style.color = 'var(--main-color)';
                        instructions.classList.add('fade-out');
                    }, 2000);
                }
            }
            
            function handleMouseMove(e) {
                if (isMobile) return;
                
                const x = e.clientX;
                const y = e.clientY;
                
                if (x < 50 && y < 50) {
                    if (!isControlPanelVisible) {
                        controlPanel.classList.add('visible');
                        isControlPanelVisible = true;
                    }
                } else if (x > controlPanel.offsetWidth || y > controlPanel.offsetHeight) {
                    if (isControlPanelVisible && !controlPanel.matches(':hover')) {
                        controlPanel.classList.remove('visible');
                        isControlPanelVisible = false;
                    }
                }
                
                if (x < 100) {
                    prevWallpaperArrow.classList.add('visible');
                } else {
                    prevWallpaperArrow.classList.remove('visible');
                }
                
                if (x > window.innerWidth - 100) {
                    nextWallpaperArrow.classList.add('visible');
                } else {
                    nextWallpaperArrow.classList.remove('visible');
                }
                
                if (x > window.innerWidth - 100 && y < 100) {
                    profileHover.classList.add('visible');
                } else {
                    profileHover.classList.remove('visible');
                }
            }
            
            function toggleMobileMenu() {
                if (isMobileMenuOpen) {
                    closeMobileMenu();
                } else {
                    openMobileMenu();
                }
            }
            
            function openMobileMenu() {
                mobileControlsContainer.classList.add('visible');
                mobileMenuButton.classList.add('active');
                isMobileMenuOpen = true;
            }
            
            function closeMobileMenu() {
                mobileControlsContainer.classList.remove('visible');
                mobileMenuButton.classList.remove('active');
                isMobileMenuOpen = false;
            }
            
            function changeWallpaper(direction) {
                currentWallpaperIndex += direction;
                
                if (currentWallpaperIndex < 0) {
                    currentWallpaperIndex = wallpapers.length - 1;
                } else if (currentWallpaperIndex >= wallpapers.length) {
                    currentWallpaperIndex = 0;
                }
                
                showWallpaper(currentWallpaperIndex);
                saveCurrentState();
            }
            
            function showWallpaper(index) {
                wallpapers.forEach(wallpaper => {
                    wallpaper.classList.remove('active');
                });
                
                if (wallpapers[index]) {
                    wallpapers[index].classList.add('active');
                }
            }
            
            function toggleModal(modal) {
                if (modal.classList.contains('visible')) {
                    closeModal(modal);
                } else {
                    openModal(modal);
                }
            }
            
            function openModal(modal) {
                modal.style.display = 'flex';
                setTimeout(() => {
                    modal.classList.add('visible');
                }, 10);
            }
            
            function closeModal(modal) {
                modal.classList.remove('visible');
                setTimeout(() => {
                    modal.style.display = 'none';
                }, 300);
            }
            
            // FIXED: Timer control functions that switch to timer wallpaper first
            function startTimer() {
                if (document.getElementById('timer-wallpaper').classList.contains('active')) {
                    document.getElementById('start-timer').click();
                } else {
                    const timerIndex = Array.from(wallpapers).findIndex(w => w.id === 'timer-wallpaper');
                    if (timerIndex !== -1) {
                        currentWallpaperIndex = timerIndex;
                        showWallpaper(currentWallpaperIndex);
                        setTimeout(() => {
                            document.getElementById('start-timer').click();
                        }, 500);
                    }
                }
            }
            
            function togglePauseTimer() {
                if (!document.getElementById('timer-wallpaper').classList.contains('active')) {
                    const timerIndex = Array.from(wallpapers).findIndex(w => w.id === 'timer-wallpaper');
                    if (timerIndex !== -1) {
                        currentWallpaperIndex = timerIndex;
                        showWallpaper(currentWallpaperIndex);
                        // Wait for timer to initialize, then pause
                        setTimeout(() => {
                            if (document.getElementById('pause-timer')) {
                                document.getElementById('pause-timer').click();
                            }
                        }, 300);
                    }
                } else {
                    if (document.getElementById('pause-timer')) {
                        document.getElementById('pause-timer').click();
                    }
                }
            }
            
            function addFiveMinutes() {
                if (!document.getElementById('timer-wallpaper').classList.contains('active')) {
                    const timerIndex = Array.from(wallpapers).findIndex(w => w.id === 'timer-wallpaper');
                    if (timerIndex !== -1) {
                        currentWallpaperIndex = timerIndex;
                        showWallpaper(currentWallpaperIndex);
                        // Wait for timer to initialize, then add time
                        setTimeout(() => {
                            if (document.getElementById('add-time')) {
                                document.getElementById('add-time').click();
                            }
                        }, 300);
                    }
                } else {
                    if (document.getElementById('add-time')) {
                        document.getElementById('add-time').click();
                    }
                }
            }
            
            function resetTimer() {
                if (!document.getElementById('timer-wallpaper').classList.contains('active')) {
                    const timerIndex = Array.from(wallpapers).findIndex(w => w.id === 'timer-wallpaper');
                    if (timerIndex !== -1) {
                        currentWallpaperIndex = timerIndex;
                        showWallpaper(currentWallpaperIndex);
                        // Wait for timer to initialize, then reset
                        setTimeout(() => {
                            if (document.getElementById('reset-timer')) {
                                document.getElementById('reset-timer').click();
                            }
                        }, 300);
                    }
                } else {
                    if (document.getElementById('reset-timer')) {
                        document.getElementById('reset-timer').click();
                    }
                }
            }
            
            // FIXED: Add task function that properly opens the modal
            function addTodo() {
                // If not on the To-Do wallpaper, switch to it
                if (!document.getElementById('todo-wallpaper').classList.contains('active')) {
                    const todoIndex = Array.from(wallpapers).findIndex(w => w.id === 'todo-wallpaper');
                    if (todoIndex !== -1) {
                        currentWallpaperIndex = todoIndex;
                        showWallpaper(currentWallpaperIndex);
                        // Wait for the wallpaper to be visible, then open modal
                        setTimeout(() => {
                            document.getElementById('add-task').click();
                        }, 300);
                    }
                } else {
                    // Already on the To-Do wallpaper, just open modal
                    document.getElementById('add-task').click();
                }
            }
            
            function clearCompletedTodos() {
                const taskList = document.getElementById('task-list');
                const tasks = taskList.querySelectorAll('.task');
                
                tasks.forEach(task => {
                    if (task.querySelector('.checked-text')) {
                        task.remove();
                    }
                });
                
                // Update task count and save
                taskCount = taskList.children.length;
                saveTodos();
                
                // Reset the UI to normal state
                resetTodoUI();
            }
            
            function resetTodoUI() {
                const taskList = document.getElementById('task-list');
                const addTaskButton = document.getElementById('add-task');
                
                // Reset opacity to normal
                taskList.style.opacity = '1';
                addTaskButton.style.opacity = '1';
                
                // Reset any celebrations
                document.querySelectorAll('.celebration, .confetti').forEach(el => el.remove());
            }
            
            // Encryption functions for export/import
            function encryptData(data, key) {
                try {
                    // Simple XOR encryption
                    let encrypted = '';
                    const stringData = JSON.stringify(data);
                    for (let i = 0; i < stringData.length; i++) {
                        const charCode = stringData.charCodeAt(i) ^ key.charCodeAt(i % key.length);
                        encrypted += String.fromCharCode(charCode);
                    }
                    return btoa(encrypted);
                } catch (e) {
                    console.error('Encryption error:', e);
                    return btoa(JSON.stringify(data)); // Fallback to plain base64
                }
            }
            
            function decryptData(encryptedData, key) {
                try {
                    const decoded = atob(encryptedData);
                    let decrypted = '';
                    for (let i = 0; i < decoded.length; i++) {
                        const charCode = decoded.charCodeAt(i) ^ key.charCodeAt(i % key.length);
                        decrypted += String.fromCharCode(charCode);
                    }
                    return JSON.parse(decrypted);
                } catch (e) {
                    console.error('Decryption error:', e);
                    // Try to parse as plain data
                    try {
                        return JSON.parse(atob(encryptedData));
                    } catch (e2) {
                        return JSON.parse(encryptedData);
                    }
                }
            }
            
            function setupSaveLoadSystem() {
                const saveTab = document.querySelector('[data-tab="save"]');
                const loadTab = document.querySelector('[data-tab="load"]');
                const exportImportTab = document.querySelector('[data-tab="export-import"]');
                const saveSection = document.getElementById('save-section');
                const loadSection = document.getElementById('load-section');
                const exportImportTabs = document.getElementById('export-import-tabs');
                const exportTab = document.querySelector('[data-tab="export"]');
                const importTab = document.querySelector('[data-tab="import"]');
                const exportSection = document.getElementById('export-section');
                const importSection = document.getElementById('import-section');
                
                [saveTab, loadTab, exportImportTab].forEach(tab => {
                    tab.addEventListener('click', () => {
                        document.querySelectorAll('.save-load-tab').forEach(t => t.classList.remove('active'));
                        tab.classList.add('active');
                        
                        saveSection.classList.remove('active');
                        loadSection.classList.remove('active');
                        exportImportTabs.style.display = 'none';
                        exportSection.style.display = 'none';
                        importSection.style.display = 'none';
                        
                        if (tab === saveTab) {
                            saveSection.classList.add('active');
                        } else if (tab === loadTab) {
                            loadSection.classList.add('active');
                        } else if (tab === exportImportTab) {
                            exportImportTabs.style.display = 'flex';
                            exportSection.style.display = 'block';
                            exportSection.classList.add('active');
                            generateExportCode();
                        }
                    });
                });
                
                if (exportTab && importTab) {
                    [exportTab, importTab].forEach(tab => {
                        tab.addEventListener('click', () => {
                            document.querySelectorAll('.export-import-tab').forEach(t => t.classList.remove('active'));
                            tab.classList.add('active');
                
                            exportSection.style.display = 'none';
                            importSection.style.display = 'none';
                            
                            if (tab === exportTab) {
                                exportSection.style.display = 'block';
                                exportSection.classList.add('active');
                                generateExportCode();
                            } else {
                                importSection.style.display = 'block';
                                importSection.classList.add('active');
                            }
                        });
                    });
                }
                
                document.getElementById('save-button').addEventListener('click', saveProgress);
                document.getElementById('load-button').addEventListener('click', loadProgress);
                document.getElementById('copy-export').addEventListener('click', copyExportCode);
                document.getElementById('email-export').addEventListener('click', emailExportCode);
                document.getElementById('import-button').addEventListener('click', importData);
            }
            
            function saveProgress() {
                const codeWord = document.getElementById('code-word-input').value.trim();
                if (!codeWord) {
                    document.getElementById('save-status').textContent = 'Please enter a code word';
                    return;
                }
                
                const saveData = getAllData();
                
                localStorage.setItem(`save_${codeWord}`, JSON.stringify(saveData));
                document.getElementById('save-status').textContent = 'Progress saved successfully!';
                document.getElementById('code-word-input').value = '';
            }
            
            function getAllData() {
                const appData = {};
                
                appData.profile = localStorage.getItem('userProfile');
                appData.todos = localStorage.getItem('todos');
                appData.notes = localStorage.getItem('userNotes');
                
                appData.timer = {
                    endTime: localStorage.getItem('timerEndTime'),
                    paused: localStorage.getItem('timerPaused'),
                    remaining: localStorage.getItem('timerRemaining')
                };
                
                appData.theme = {
                    color: localStorage.getItem('mainColor') || '#00ffff',
                    glow: localStorage.getItem('glowIntensity') || '1'
                };
                appData.currentWallpaper = currentWallpaperIndex;
                appData.currentImageData = currentImageData;
                appData.currentWallpaperIndex = localStorage.getItem('currentWallpaperIndex');
                
                appData.timestamp = Date.now();
                appData.version = '2.1';
                
                return appData;
            }
            
            function loadProgress() {
                const codeWord = document.getElementById('load-code-input').value.trim();
                if (!codeWord) {
                    document.getElementById('load-status').textContent = 'Please enter a code word';
                    return;
                }
                
                const saveData = localStorage.getItem(`save_${codeWord}`);
                if (!saveData) {
                    document.getElementById('load-status').textContent = 'No saved progress found for this code word';
                    return;
                }
                
                try {
                    const data = JSON.parse(saveData);
                    
                    if (data.profile) {
                        localStorage.setItem('userProfile', data.profile);
                    }
                    if (data.todos) {
                        localStorage.setItem('todos', data.todos);
                    }
                    if (data.notes) {
                        localStorage.setItem('userNotes', data.notes);
                    }
                    if (data.timer) {
                        if (data.timer.endTime) localStorage.setItem('timerEndTime', data.timer.endTime);
                        if (data.timer.paused) localStorage.setItem('timerPaused', data.timer.paused);
                        if (data.timer.remaining) localStorage.setItem('timerRemaining', data.timer.remaining);
                    }
                    if (data.theme) {
                        localStorage.setItem('mainColor', data.theme.color);
                        localStorage.setItem('glowIntensity', data.theme.glow);
                        applyTheme(data.theme.color, data.theme.glow);
                    }
                    if (data.currentWallpaper !== undefined) {
                        currentWallpaperIndex = data.currentWallpaper;
                    }
                    if (data.currentImageData) {
                        currentImageData = data.currentImageData;
                        localStorage.setItem('currentImageData', data.currentImageData);
                    }
                    if (data.currentWallpaperIndex) {
                        localStorage.setItem('currentWallpaperIndex', data.currentWallpaperIndex);
                    }
                    
                    document.getElementById('load-status').textContent = 'Progress loaded successfully!';
                    document.getElementById('load-status').style.color = 'var(--main-color)';
                    
                    loadProfile();
                    loadTodos();
                    loadImageFromStorage();
                    initializeTimerFromStorage();
                    showWallpaper(currentWallpaperIndex);
                    
                    setTimeout(() => {
                        closeModal(saveLoadModal);
                    }, 1500);
                    
                } catch (e) {
                    console.error('Error loading progress:', e);
                    document.getElementById('load-status').textContent = 'Error loading progress';
                    document.getElementById('load-status').style.color = 'red';
                }
            }
            
            function generateExportCode() {
                const exportData = getAllData();
                try {
                    // Use user's name or a default key for encryption
                    const profile = JSON.parse(localStorage.getItem('userProfile') || '{}');
                    const encryptionKey = profile.name || 'FocusDomain2024!';
                    
                    const exportString = encryptData(exportData, encryptionKey);
                    document.getElementById('export-code').value = exportString;
                } catch (e) {
                    console.error('Error generating export code:', e);
                    // Fallback to plain base64
                    document.getElementById('export-code').value = btoa(JSON.stringify(exportData));
                }
            }
            
            function copyExportCode() {
                const exportCode = document.getElementById('export-code');
                exportCode.select();
                exportCode.setSelectionRange(0, 99999);
                navigator.clipboard.writeText(exportCode.value);
                
                const status = document.getElementById('export-status');
                status.textContent = 'Export code copied to clipboard!';
                status.style.color = 'var(--main-color)';
                setTimeout(() => {
                    status.textContent = '';
                }, 3000);
            }
            
            function emailExportCode() {
                const profile = JSON.parse(localStorage.getItem('userProfile') || '{}');
                const email = profile.email;
                
                if (!email) {
                    document.getElementById('export-status').textContent = 'Please set your email in Profile Settings first';
                    document.getElementById('export-status').style.color = 'red';
                    return;
                }
                
                const exportCode = document.getElementById('export-code').value;
                const subject = 'Focus Domain Export Code';
                const body = `Here is your Focus Domain export code:\n\n${exportCode}\n\nUse this code to import your data on another device.`;
                
                window.open(`mailto:${email}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`);
                document.getElementById('export-status').textContent = 'Email opened with export code';
                document.getElementById('export-status').style.color = 'var(--main-color)';
            }
            
            function importData() {
                const importCode = document.getElementById('import-code').value.trim();
                if (!importCode) {
                    document.getElementById('import-status').textContent = 'Please paste an export code';
                    document.getElementById('import-status').style.color = 'red';
                    return;
                }
                
                try {
                    let importData;
                    
                    // Get encryption key from user profile
                    const profile = JSON.parse(localStorage.getItem('userProfile') || '{}');
                    const encryptionKey = profile.name || 'FocusDomain2024!';
                    
                    try {
                        // First try to decrypt with encryption
                        importData = decryptData(importCode, encryptionKey);
                    } catch (e1) {
                        // If that fails, try plain base64
                        try {
                            const decoded = atob(importCode);
                            importData = JSON.parse(decoded);
                        } catch (e2) {
                            // Try plain JSON
                            try {
                                importData = JSON.parse(importCode);
                            } catch (e3) {
                                try {
                                    const decoded = decodeURIComponent(importCode);
                                    importData = JSON.parse(decoded);
                                } catch (e4) {
                                    throw new Error('Invalid export code format. Please check the code and try again.');
                                }
                            }
                        }
                    }
                    
                    if (!importData || typeof importData !== 'object') {
                        throw new Error('Invalid export data structure');
                    }
                    
                    if (importData.profile) {
                        localStorage.setItem('userProfile', importData.profile);
                    }
                    
                    if (importData.todos) {
                        localStorage.setItem('todos', importData.todos);
                    }
                    
                    if (importData.notes) {
                        localStorage.setItem('userNotes', importData.notes);
                    }
                    
                    if (importData.timer) {
                        if (importData.timer.endTime) {
                            localStorage.setItem('timerEndTime', importData.timer.endTime);
                        }
                        if (importData.timer.paused) {
                            localStorage.setItem('timerPaused', importData.timer.paused);
                        }
                        if (importData.timer.remaining) {
                            localStorage.setItem('timerRemaining', importData.timer.remaining);
                        }
                    }
                    
                    if (importData.theme) {
                        const themeColor = importData.theme.color || '#00ffff';
                        const themeGlow = importData.theme.glow || '1';
                        
                        localStorage.setItem('mainColor', themeColor);
                        localStorage.setItem('glowIntensity', themeGlow);
                        
                        document.documentElement.style.setProperty('--main-color', themeColor);
                        document.documentElement.style.setProperty('--glow-intensity', themeGlow);
                    }
                    
                    if (importData.currentWallpaper !== undefined) {
                        currentWallpaperIndex = importData.currentWallpaper;
                    }
                    
                    if (importData.currentImageData) {
                        currentImageData = importData.currentImageData;
                        localStorage.setItem('currentImageData', importData.currentImageData);
                    }
                    
                    if (importData.currentWallpaperIndex) {
                        localStorage.setItem('currentWallpaperIndex', importData.currentWallpaperIndex);
                    }
                    
                    document.getElementById('import-status').textContent = 'Data imported successfully!';
                    document.getElementById('import-status').style.color = 'var(--main-color)';
                    
                    loadProfile();
                    loadTodos();
                    loadImageFromStorage();
                    initializeTimerFromStorage();
                    showWallpaper(currentWallpaperIndex);
                    
                    setTimeout(() => {
                        closeModal(saveLoadModal);
                    }, 1500);
                    
                } catch (e) {
                    console.error('Import error:', e);
                    document.getElementById('import-status').textContent = 'Error: ' + e.message;
                    document.getElementById('import-status').style.color = 'red';
                }
            }
            
            function setupThemeCustomizer() {
                const colorPicker = document.getElementById('color-picker');
                const glowSlider = document.getElementById('glow-slider');
                const glowValue = document.getElementById('glow-value');
                const applyThemeBtn = document.getElementById('apply-theme');
                
                const savedColor = localStorage.getItem('mainColor') || '#00ffff';
                const savedGlow = localStorage.getItem('glowIntensity') || '1';
                
                colorPicker.value = savedColor;
                glowSlider.value = savedGlow;
                glowValue.textContent = savedGlow;
                
                colorPicker.addEventListener('input', () => {
                    previewTheme(colorPicker.value, glowSlider.value);
                });
                
                glowSlider.addEventListener('input', () => {
                    glowValue.textContent = glowSlider.value;
                    previewTheme(colorPicker.value, glowSlider.value);
                });
                
                applyThemeBtn.addEventListener('click', () => {
                    applyTheme(colorPicker.value, glowSlider.value);
                    closeModal(themeModal);
                });
            }
            
            function previewTheme(color, glow) {
                document.documentElement.style.setProperty('--main-color', color);
                document.documentElement.style.setProperty('--glow-intensity', glow);
            }
            
            function applyTheme(color, glow) {
                localStorage.setItem('mainColor', color);
                localStorage.setItem('glowIntensity', glow);
                
                document.documentElement.style.setProperty('--main-color', color);
                document.documentElement.style.setProperty('--glow-intensity', glow);
                
                const newTaskInput = document.getElementById('new-task-input');
                if (newTaskInput) {
                    newTaskInput.style.setProperty('--main-color', color);
                }
            }
            
            function setupProfileSystem() {
                const profileName = document.getElementById('profile-name');
                const profileEmail = document.getElementById('profile-email');
                const profileAvatarUrl = document.getElementById('profile-avatar-url');
                const saveProfileBtn = document.getElementById('save-profile');
                const profileNameDisplay = document.getElementById('profile-name-display');
                const profileAvatar = document.getElementById('profile-avatar');
                const uploadAvatarBtn = document.getElementById('upload-avatar-btn');
                const avatarFileInput = document.getElementById('avatar-file-input');
                
                const savedProfile = localStorage.getItem('userProfile');
                if (savedProfile) {
                    const profile = JSON.parse(savedProfile);
                    profileName.value = profile.name || '';
                    profileEmail.value = profile.email || '';
                    profileAvatarUrl.value = profile.avatarUrl || '';
                    
                    profileNameDisplay.textContent = profile.name || 'User';
                    updateProfileAvatar(profile.avatarUrl, profile.name);
                }
                
                profileName.addEventListener('input', () => {
                    profileNameDisplay.textContent = profileName.value || 'User';
                });
                
                profileAvatarUrl.addEventListener('input', () => {
                    updateProfileAvatar(profileAvatarUrl.value, profileName.value);
                });
                
                saveProfileBtn.addEventListener('click', saveProfile);
                
                uploadAvatarBtn.addEventListener('click', () => {
                    avatarFileInput.click();
                });
                
                avatarFileInput.addEventListener('change', function(e) {
                    const file = e.target.files[0];
                    if (file && file.type.startsWith('image/')) {
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            profileAvatarUrl.value = e.target.result;
                            updateProfileAvatar(e.target.result, profileName.value);
                        };
                        reader.readAsDataURL(file);
                    }
                });
            }
            
            function updateProfileAvatar(avatarUrl, name) {
                const profileAvatar = document.getElementById('profile-avatar');
                const profileHoverAvatar = document.getElementById('profile-hover-avatar');
                
                if (avatarUrl && avatarUrl.trim() !== '') {
                    profileAvatar.style.backgroundImage = `url(${avatarUrl})`;
                    profileAvatar.style.backgroundSize = 'cover';
                    profileAvatar.textContent = '';
                    
                    profileHoverAvatar.style.backgroundImage = `url(${avatarUrl})`;
                    profileHoverAvatar.style.backgroundSize = 'cover';
                    profileHoverAvatar.textContent = '';
                } else {
                    profileAvatar.style.backgroundImage = '';
                    profileAvatar.textContent = name ? name.charAt(0).toUpperCase() : 'üë§';
                    
                    profileHoverAvatar.style.backgroundImage = '';
                    profileHoverAvatar.textContent = name ? name.charAt(0).toUpperCase() : 'üë§';
                }
            }
            
            function saveProfile() {
                const profile = {
                    name: document.getElementById('profile-name').value,
                    email: document.getElementById('profile-email').value,
                    avatarUrl: document.getElementById('profile-avatar-url').value
                };
                
                localStorage.setItem('userProfile', JSON.stringify(profile));
                loadProfile();
                closeModal(profileModal);
            }
            
            function loadProfile() {
                const savedProfile = localStorage.getItem('userProfile');
                if (savedProfile) {
                    const profile = JSON.parse(savedProfile);
                    profileHoverName.textContent = profile.name || 'User';
                    updateProfileAvatar(profile.avatarUrl, profile.name);
                }
            }
            
            function setupNotesSystem() {
                const notesText = document.getElementById('notes-text');
                const saveNotesBtn = document.getElementById('save-notes');
                
                const savedNotes = localStorage.getItem('userNotes');
                if (savedNotes) {
                    notesText.value = savedNotes;
                }
                
                saveNotesBtn.addEventListener('click', () => {
                    localStorage.setItem('userNotes', notesText.value);
                    closeModal(notesModal);
                });
            }
            
            function setupTimerWallpaper() {
                const timerPopup = document.getElementById('timer-popup');
                const hoursInput = document.getElementById('hours');
                const minutesInput = document.getElementById('minutes');
                const secondsInput = document.getElementById('seconds');
                const startTimerBtn = document.getElementById('start-timer');
                const activeTimer = document.getElementById('active-timer');
                const controlButtons = document.getElementById('control-buttons');
                const addTimeBtn = document.getElementById('add-time');
                const pauseTimerBtn = document.getElementById('pause-timer');
                const resetTimerBtn = document.getElementById('reset-timer');
                
                let binaryInterval;

                const timerArea = document.getElementById('timer-wallpaper');
                timerArea.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                });
                
                timerArea.addEventListener('contextmenu', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                });
                
                timerArea.addEventListener('dragover', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                });
                
                timerArea.addEventListener('drop', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                });

                startTimerBtn.addEventListener('click', startTimerFromButton);
                addTimeBtn.addEventListener('click', addFiveMinutesFromButton);
                pauseTimerBtn.addEventListener('click', togglePauseFromButton);
                resetTimerBtn.addEventListener('click', resetTimerFromButton);
                document.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter' && document.getElementById('timer-wallpaper').classList.contains('active')) {
                        startTimerFromButton();
                    }
                });
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'R' && e.shiftKey && document.getElementById('timer-wallpaper').classList.contains('active')) {
                        resetTimerFromButton();
                    }
                });

                function startTimerFromButton() {
                    const hours = parseInt(hoursInput.value) || 0;
                    const minutes = parseInt(minutesInput.value) || 0;
                    const seconds = parseInt(secondsInput.value) || 0;

                    const totalSeconds = (hours * 3600) + (minutes * 60) + seconds;
                    if (totalSeconds <= 0) return;

                    startTimerWithSeconds(totalSeconds);
                    
                    // Reset notification flag when starting new timer
                    hasShownTimerNotification = false;
                    stopTitleFlash();
                    document.title = originalTitle;
                }
                
                function startTimerWithSeconds(totalSeconds) {
                    timerEndTime = Date.now() + (totalSeconds * 1000);
                    remainingSeconds = totalSeconds;
                    
                    localStorage.setItem('timerEndTime', timerEndTime.toString());
                    localStorage.setItem('timerPaused', 'false');
                    localStorage.removeItem('timerRemaining');
                    
                    showActiveTimer();
                    isTimerRunning = true;
                    isTimerPaused = false;
                    
                    startTimerCountdown();
                    startBinaryStream();
                    
                    // Reset notification flag
                    hasShownTimerNotification = false;
                    stopTitleFlash();
                    document.title = originalTitle;
                }
                
                function showActiveTimer() {
                    timerPopup.style.display = 'none';
                    activeTimer.style.display = 'block';
                    controlButtons.style.display = 'flex';
                    pauseTimerBtn.textContent = 'II';
                    
                    updateTimerDisplay(remainingSeconds);
                }
                
                function startTimerCountdown() {
                    if (timerInterval) {
                        clearInterval(timerInterval);
                    }
                    
                    lastUpdateTime = Date.now();
                    timerInterval = setInterval(updateTimer, 100);
                }
                
                function updateTimer() {
                    const now = Date.now();
                    const timePassed = now - lastUpdateTime;
                    lastUpdateTime = now;
                    
                    if (!isTimerPaused) {
                        if (timerEndTime <= now) {
                            clearInterval(timerInterval);
                            timerInterval = null;
                            
                            // Show notification when timer completes
                            showTimerCompletionNotification();
                            
                            resetTimerFromButton();
                        } else {
                            remainingSeconds = Math.ceil((timerEndTime - now) / 1000);
                            updateTimerDisplay(remainingSeconds);
                            
                            if (now % 5000 < 100) {
                                localStorage.setItem('timerEndTime', timerEndTime.toString());
                            }
                        }
                    }
                }
                
                function updateTimerDisplay(seconds) {
                    const hours = Math.floor(seconds / 3600);
                    const mins = Math.floor((seconds % 3600) / 60);
                    const secs = seconds % 60;
                    activeTimer.textContent = `${hours}:${mins < 10 ? '0' : ''}${mins}:${secs < 10 ? '0' : ''}${secs}`;
                }
                
                function addFiveMinutesFromButton() {
                    if (!isTimerRunning) return;
                    
                    remainingSeconds += 300;
                    if (!isTimerPaused) {
                        timerEndTime = Date.now() + (remainingSeconds * 1000);
                        localStorage.setItem('timerEndTime', timerEndTime.toString());
                    } else {
                        localStorage.setItem('timerRemaining', remainingSeconds.toString());
                    }
                    
                    updateTimerDisplay(remainingSeconds);
                    
                    activeTimer.style.color = 'lime';
                    setTimeout(() => {
                        activeTimer.style.color = 'var(--main-color)';
                    }, 300);
                }
                
                function togglePauseFromButton() {
                    if (!isTimerRunning) return;
                    
                    isTimerPaused = !isTimerPaused;
                    
                    if (isTimerPaused) {
                        pauseTimerBtn.textContent = '‚ñ∂';
                        if (timerInterval) {
                            clearInterval(timerInterval);
                            timerInterval = null;
                        }
                        localStorage.setItem('timerPaused', 'true');
                        localStorage.setItem('timerRemaining', remainingSeconds.toString());
                    } else {
                        pauseTimerBtn.textContent = 'II';
                        timerEndTime = Date.now() + (remainingSeconds * 1000);
                        localStorage.setItem('timerEndTime', timerEndTime.toString());
                        localStorage.setItem('timerPaused', 'false');
                        localStorage.removeItem('timerRemaining');
                        startTimerCountdown();
                    }
                }
                
                function resetTimerFromButton() {
                    if (timerInterval) {
                        clearInterval(timerInterval);
                        timerInterval = null;
                    }
                    
                    clearInterval(binaryInterval);
                    document.querySelectorAll('.binary-stream').forEach(el => el.remove());
                    
                    timerPopup.style.display = 'block';
                    activeTimer.style.display = 'none';
                    controlButtons.style.display = 'none';
                    
                    clearTimerStorage();
                    
                    isTimerRunning = false;
                    isTimerPaused = false;
                    remainingSeconds = 0;
                    hasShownTimerNotification = false;
                    stopTitleFlash();
                    document.title = originalTitle;
                    
                    hoursInput.value = 0;
                    minutesInput.value = 25;
                    secondsInput.value = 0;
                }
                
                function startBinaryStream() {
                    clearInterval(binaryInterval);
                    binaryInterval = setInterval(() => {
                        if (isTimerPaused || !isTimerRunning) return;
                        
                        const binary = document.createElement('div');
                        binary.className = 'binary-stream';
                        binary.textContent = Math.random() > 0.5 ? '1' : '0';
                        
                        const angle = Math.random() * 2 * Math.PI;
                        binary.style.setProperty('--tx', Math.cos(angle));
                        binary.style.setProperty('--ty', Math.sin(angle));
                        
                        binary.style.left = '50%';
                        binary.style.top = '50%';
                        binary.style.animationDuration = `${Math.random() * 2 + 1}s`;
                        
                        document.getElementById('timer-wallpaper').appendChild(binary);
                        setTimeout(() => binary.remove(), 3000);
                    }, 50);
                }
            }
            
            function loadTodos() {
                const taskList = document.getElementById('task-list');
                const savedTodos = localStorage.getItem('todos');
                
                if (savedTodos) {
                    try {
                        const todos = JSON.parse(savedTodos);
                        taskList.innerHTML = '';
                        taskCount = 0;
                        
                        todos.forEach(todo => {
                            const listItem = document.createElement('li');
                            listItem.className = 'task';

                            const checkBox = document.createElement('div');
                            checkBox.className = 'check-box';
                            if (todo.completed) {
                                checkBox.classList.add('checked');
                            }
                            
                            checkBox.addEventListener('click', function() {
                                taskContent.classList.toggle('checked-text');
                                checkBox.classList.toggle('checked');
                                checkCompletion();
                                saveTodos();
                            });

                            const taskContent = document.createElement('span');
                            taskContent.className = 'task-text';
                            taskContent.innerText = todo.text;
                            if (todo.completed) {
                                taskContent.classList.add('checked-text');
                            }

                            listItem.appendChild(checkBox);
                            listItem.appendChild(taskContent);
                            taskList.appendChild(listItem);
                            taskCount++;
                        });
                        
                        checkCompletion();
                        todoListInitialized = true;
                    } catch (e) {
                        console.error('Error loading todos:', e);
                    }
                }
            }
            
            function saveTodos() {
                const tasks = document.querySelectorAll('#task-list .task');
                const todos = [];
                
                tasks.forEach(task => {
                    const text = task.querySelector('.task-text').textContent;
                    const completed = task.querySelector('.check-box').classList.contains('checked');
                    todos.push({ text, completed });
                });
                
                localStorage.setItem('todos', JSON.stringify(todos));
            }
            
            function checkCompletion() {
                const taskList = document.getElementById('task-list');
                if (!taskList) return;
                
                const totalTasks = taskList.children.length;
                if (totalTasks === 0) return;
                
                const completedTasks = Array.from(taskList.children).filter(task => {
                    const checkBox = task.querySelector('.check-box');
                    return checkBox && checkBox.classList.contains('checked');
                }).length;

                if (completedTasks === totalTasks && totalTasks > 0) {
                    celebrate();
                }
            }
            
            function celebrate() {
                const celebrationText = document.createElement('div');
                celebrationText.className = 'celebration';
                celebrationText.innerText = '‚ùÑÔ∏è All tasks completed ‚ùÑÔ∏è';
                document.getElementById('todo-wallpaper').appendChild(celebrationText);

                for (let i = 0; i < 50; i++) {
                    createConfetti();
                }

                setTimeout(() => {
                    celebrationText.remove();
                    fadeOutTasks();
                }, 3000);
            }
            
            function fadeOutTasks() {
                const taskList = document.getElementById('task-list');
                const addTaskButton = document.getElementById('add-task');
                
                if (!taskList || !addTaskButton) return;
                
                // Fade out
                taskList.style.opacity = 0;
                addTaskButton.style.opacity = 0;

                // Wait for fade out, then clear and reset
                setTimeout(() => {
                    taskList.innerHTML = '';
                    taskCount = 0;
                    
                    // Reset to normal state
                    setTimeout(() => {
                        taskList.style.opacity = 1;
                        addTaskButton.style.opacity = 1;
                        saveTodos();
                    }, 300);
                }, 1000);
            }
            
            function createConfetti() {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.backgroundColor = getRandomColor();

                document.getElementById('todo-wallpaper').appendChild(confetti);

                setTimeout(() => {
                    confetti.remove();
                }, 1500);
            }
            
            function getRandomColor() {
                const colors = ['var(--main-color)', '#00ffff', '#00ccff', '#0099ff', '#ff00ff', '#ffff00'];
                return colors[Math.floor(Math.random() * colors.length)];
            }
            
            function setupTodoWallpaper() {
                const addTaskButton = document.getElementById('add-task');
                const modal = document.getElementById('modal');
                const newTaskInput = document.getElementById('new-task-input');
                const taskList = document.getElementById('task-list');
                const maxTasks = 10;

                function openModal() {
                    modal.classList.add('visible');
                    modal.style.display = 'block';
                    newTaskInput.value = '';
                    newTaskInput.focus();
                }

                addTaskButton.addEventListener('click', openModal);

                newTaskInput.addEventListener('keypress', function(event) {
                    if (event.key === 'Enter') {
                        const taskText = newTaskInput.value.trim();
                        if (taskText && taskCount < maxTasks) {
                            addTask(taskText);
                            newTaskInput.value = '';
                            newTaskInput.focus();
                        } else if (taskCount >= maxTasks) {
                            alert('Maximum number of tasks reached (10)');
                        }
                    }
                });

                function addTask(taskText) {
                    const listItem = document.createElement('li');
                    listItem.className = 'task';

                    const checkBox = document.createElement('div');
                    checkBox.className = 'check-box';
                    checkBox.addEventListener('click', function() {
                        taskContent.classList.toggle('checked-text');
                        checkBox.classList.toggle('checked');
                        checkCompletion();
                        saveTodos();
                    });

                    const taskContent = document.createElement('span');
                    taskContent.className = 'task-text';
                    taskContent.innerText = taskText;

                    listItem.appendChild(checkBox);
                    listItem.appendChild(taskContent);
                    taskList.appendChild(listItem);

                    taskCount++;
                    saveTodos();
                    
                    checkCompletion();
                }

                window.addEventListener('click', function (event) {
                    if (event.target === modal) {
                        closeModal();
                    }
                });

                window.addEventListener('keydown', function (event) {
                    if (event.key === 'Escape') {
                        closeModal();
                    }
                });

                function closeModal() {
                    modal.classList.remove('visible');
                    modal.style.display = 'none';
                }
                
                // Initialize the todo list
                if (!todoListInitialized) {
                    loadTodos();
                }
            }
            
            function setupImageWallpaper() {
                const fileInput = document.getElementById('fileInput');
                const fullscreenMode = document.getElementById('fullscreenMode');
                const fullscreenImage = document.getElementById('fullscreenImage');
                const fileInfo = document.getElementById('fileInfo');
                const container = document.querySelector('#image-wallpaper .container');

                fileInput.addEventListener('change', function(e) {
                    const file = e.target.files[0];
                    if (file) {
                        if (file.type.startsWith('image/')) {
                            const reader = new FileReader();
                            
                            reader.onload = function(e) {
                                const imageData = e.target.result;
                                currentImageData = imageData;
                                localStorage.setItem('currentImageData', imageData);
                                
                                container.style.display = 'none';
                                fullscreenMode.style.display = 'block';
                                fullscreenImage.src = imageData;
                                fileInfo.textContent = `Loaded: ${file.name} (${(file.size / 1024).toFixed(1)} KB)`;
                            };
                            
                            reader.readAsDataURL(file);
                        } else {
                            alert('Please select a valid image file.');
                        }
                    }
                });

                document.addEventListener('keydown', function(e) {
                    if (e.key === 'Escape' && fullscreenMode.style.display === 'block') {
                        exitFullscreen();
                    }
                });

                function exitFullscreen() {
                    container.style.display = 'block';
                    fullscreenMode.style.display = 'none';
                    fileInput.value = '';
                }
            }
            
            function loadImageFromStorage() {
                if (currentImageData) {
                    const container = document.querySelector('#image-wallpaper .container');
                    const fullscreenMode = document.getElementById('fullscreenMode');
                    const fullscreenImage = document.getElementById('fullscreenImage');
                    
                    container.style.display = 'none';
                    fullscreenMode.style.display = 'block';
                    fullscreenImage.src = currentImageData;
                }
            }
            
            function toggleFullscreen() {
                if (!document.fullscreenElement) {
                    document.documentElement.requestFullscreen().catch(err => {
                        console.log(`Error attempting to enable fullscreen: ${err.message}`);
                    });
                } else {
                    if (document.exitFullscreen) {
                        document.exitFullscreen();
                    }
                }
            }
            
            document.addEventListener('keydown', (e) => {
                const todoModal = document.getElementById('modal');
                const isTodoModalOpen = todoModal.classList.contains('visible');
                
                if (isTodoModalOpen && document.activeElement === document.getElementById('new-task-input')) {
                    return;
                }
                
                if (document.querySelector('.modal.visible')) return;
                
                switch(e.key) {
                    case 'ArrowLeft':
                        e.preventDefault();
                        changeWallpaper(-1);
                        break;
                    case 'ArrowRight':
                        e.preventDefault();
                        changeWallpaper(1);
                        break;
                    case 's':
                    case 'S':
                        if (e.ctrlKey && e.altKey) {
                            e.preventDefault();
                            toggleModal(saveLoadModal);
                        }
                        break;
                    case 'c':
                    case 'C':
                        if (e.shiftKey && !e.ctrlKey && !e.altKey) {
                            e.preventDefault();
                            toggleModal(themeModal);
                        }
                        break;
                    case 'p':
                    case 'P':
                        if (e.ctrlKey && e.altKey) {
                            e.preventDefault();
                            toggleModal(profileModal);
                        }
                        break;
                    case 'n':
                    case 'N':
                        if (e.altKey) {
                            e.preventDefault();
                            toggleModal(notesModal);
                        }
                        break;
                    case 'i':
                    case 'I':
                        if (e.altKey) {
                            e.preventDefault();
                            toggleModal(infoModal);
                        }
                        break;
                    case 'Escape':
                        document.querySelectorAll('.modal.visible').forEach(modal => {
                            closeModal(modal);
                        });
                        break;
                    case 'Enter':
                        if (document.getElementById('timer-wallpaper').classList.contains('active')) {
                            const startBtn = document.getElementById('start-timer');
                            if (startBtn && startBtn.style.display !== 'none') {
                                startBtn.click();
                            }
                        }
                        break;
                    case 'R':
                        if (e.shiftKey) {
                            if (document.getElementById('timer-wallpaper').classList.contains('active')) {
                                document.getElementById('reset-timer').click();
                            }
                        }
                        break;
                    case '+':
                        if (document.getElementById('timer-wallpaper').classList.contains('active')) {
                            document.getElementById('add-time').click();
                        }
                        break;
                    case 'F11':
                        e.preventDefault();
                        toggleFullscreen();
                        break;
                    case 'f':
                    case 'F':
                        if (e.ctrlKey) {
                            e.preventDefault();
                            toggleFullscreen();
                        }
                        break;
                }
            });
            
            if (isMobile) {
                instructions.textContent = "Tap bottom of screen to show navigation arrows";
            }
        })();
    </script>
</body>
</html>
